generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "rhel-openssl-1.0.x", "rhel-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                      String             @id @default(uuid())
  email                   String?            @unique
  password                String
  name                    String
  avatarUrl               String?
  rating                  Float              @default(5.0)
  reviewCount             Int                @default(0)
  isVerified              Boolean            @default(false)
  carModel                String?
  createdAt               DateTime           @default(now())
  updatedAt               DateTime           @updatedAt
  phone                   String             @unique
  refreshToken            String?
  isDriver                Boolean            @default(false)
  bookings                Booking[]
  messagesReceived        Message[]          @relation("ReceivedMessages")
  messagesSent            Message[]          @relation("SentMessages")
  notifications           Notification[]
  rides                   Ride[]
  verificationCodes       VerificationCode[]
  rideRequests            RideRequest[]      @relation("PassengerRequests")
  acceptedRideRequests    RideRequest[]      @relation("DriverAcceptedRequests")
}

model Ride {
  id                 String    @id @default(uuid())
  driverId           String
  originCity         String
  originAddress      String?
  originLat          Float?
  originLng          Float?
  destinationCity    String
  destinationAddress String?
  destinationLat     Float?
  destinationLng     Float?
  departureTime      DateTime
  pricePerSeat       Int
  currency           String    @default("XOF")
  totalSeats         Int
  availableSeats     Int
  description        String?
  features           String[]
  estimatedDuration  Int       @default(0)
  distance           Float?
  status             String    @default("OPEN")
  createdAt          DateTime  @default(now())
  updatedAt          DateTime  @updatedAt
  bookings           Booking[]
  driver             User      @relation(fields: [driverId], references: [id])
}

model Booking {
  id          String   @id @default(uuid())
  rideId      String
  passengerId String
  seats       Int
  status      String   @default("PENDING")
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  passenger   User     @relation(fields: [passengerId], references: [id])
  ride        Ride     @relation(fields: [rideId], references: [id])
}

model GuestBooking {
  id          String   @id @default(uuid())
  rideId      String?
  origin      String
  destination String
  date        DateTime
  seats       Int
  name        String
  phone       String
  status      String   @default("PENDING")
  createdAt   DateTime @default(now())
}

model Message {
  id         String   @id @default(uuid())
  content    String
  senderId   String
  receiverId String
  read       Boolean  @default(false)
  createdAt  DateTime @default(now())
  receiver   User     @relation("ReceivedMessages", fields: [receiverId], references: [id])
  sender     User     @relation("SentMessages", fields: [senderId], references: [id])
}

model Notification {
  id        String   @id @default(uuid())
  userId    String
  type      String
  title     String
  message   String
  read      Boolean  @default(false)
  data      Json?
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id])
}

model VerificationCode {
  id        String   @id @default(uuid())
  code      String
  expiresAt DateTime
  createdAt DateTime @default(now())
  type      String
  userId    String
  user      User     @relation(fields: [userId], references: [id])
}

model RideRequest {
  id                 String   @id @default(uuid())
  passengerId        String
  originCity         String
  destinationCity    String
  departureDate      DateTime
  seats              Int
  maxPricePerSeat    Int?
  description        String?
  status             String   @default("PENDING") // PENDING, ACCEPTED, CANCELLED
  acceptedByDriverId String?
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
  passenger          User     @relation("PassengerRequests", fields: [passengerId], references: [id])
  acceptedByDriver   User?    @relation("DriverAcceptedRequests", fields: [acceptedByDriverId], references: [id])
}
